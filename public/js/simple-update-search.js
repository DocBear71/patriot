function initializeSimpleUpdateSearch(){console.log("Initializing simple update search...");const e=document.getElementById("business-search-form");if(!e)return void console.error("Search form not found");e.onsubmit=null;const s=e.cloneNode(!0);e.parentNode.replaceChild(s,e),document.getElementById("business-search-form").addEventListener("submit",handleUpdateSearch),console.log("Simple update search initialized successfully")}async function handleUpdateSearch(e){e.preventDefault(),console.log("Simple update search: Form submitted");const s=document.getElementById("business-name")?.value||"",t=document.getElementById("address")?.value||"";if(!s.trim()&&!t.trim())return void alert("Please enter either a business name or an address to search");const n={businessName:s.trim(),address:t.trim()};console.log("Simple update search: Searching with",n);try{showSimpleLoadingIndicator(),displaySimpleUpdateResults(await performSimpleUpdateSearch(n))}catch(e){console.error("Simple update search error:",e),showSimpleErrorMessage("Error searching for businesses: "+e.message)}}async function performSimpleUpdateSearch(e){console.log("Performing simple update search...");try{const s=getSimpleBaseURL(),t=new URLSearchParams;t.append("operation","search"),e.businessName&&t.append("business_name",e.businessName),e.address&&t.append("address",e.address);const n=`${s}/api/business.js?${t.toString()}`;console.log("Simple search API URL:",n);const l=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json; charset=UTF-8"}});if(!l.ok)throw new Error(`Search failed: ${l.status}`);const i=((await l.json()).results||[]).filter((e=>!0!==e.is_chain||(console.log(`Filtering out parent chain: ${e.bname}`),!1)));return console.log(`Simple search: Found ${i.length} businesses`),i}catch(e){throw console.error("Simple search error:",e),e}}document.addEventListener("DOMContentLoaded",(function(){console.log("Simple Update Search Handler Loaded!"),setTimeout((function(){initializeSimpleUpdateSearch()}),200)}));let lastSuccessfulResults=null;function displaySimpleUpdateResults(e){console.log(`Displaying ${e.length} businesses in simple table`),lastSuccessfulResults=e;const s=document.getElementById("business-search-results");if(!s)return void console.error("Results container not found");if(s.innerHTML="",0===e.length)return s.innerHTML='\n            <div class="simple-no-results">\n                <h3>No businesses found</h3>\n                <p>No businesses match your search criteria. Please try different search terms.</p>\n            </div>\n        ',void(s.style.display="block");const t=createSimpleResultsTable(e);s.innerHTML=t,s.style.display="block",s.scrollIntoView({behavior:"smooth"}),console.log("Simple results displayed successfully")}function createSimpleResultsTable(e){let s=`\n        <div class="simple-results-container">\n            <h3>Search Results (${e.length} found)</h3>\n            <table class="simple-results-table">\n                <thead>\n                    <tr>\n                        <th>Business Name</th>\n                        <th>Address</th>\n                        <th>Type</th>\n                        <th>Status</th>\n                        <th>Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n    `;return e.forEach((e=>{let t="";e.address1&&(t=e.address1,e.address2&&(t+=", "+e.address2),e.city&&(t+=", "+e.city),e.state&&(t+=", "+e.state),e.zip&&(t+=" "+e.zip));const n=getSimpleBusinessTypeLabel(e.type),l=e.status||"active",i="active"===l?"simple-status-active":"simple-status-inactive",o=e.chain_id?'<span class="simple-chain-badge">Chain</span>':"";s+=`\n            <tr class="simple-business-row">\n                <td>${e.bname} ${o}</td>\n                <td>${t}</td>\n                <td>${n}</td>\n                <td><span class="simple-status-badge ${i}">${l}</span></td>\n                <td>\n                    <button class="simple-select-btn" onclick="selectSimpleBusinessForUpdate('${e._id}')">\n                        Select for Update\n                    </button>\n                </td>\n            </tr>\n        `})),s+="\n                </tbody>\n            </table>\n        </div>\n    ",s}function restoreSimpleResultsTable(){if(console.log("Restoring simple results table"),lastSuccessfulResults&&lastSuccessfulResults.length>0){const e=document.getElementById("business-search-results");if(e){const s=createSimpleResultsTable(lastSuccessfulResults);e.innerHTML=s,e.style.display="block",console.log("Results table restored successfully")}}else console.log("No previous results to restore"),hideSimpleLoadingIndicator()}async function fetchSimpleBusinessDetails(e){const s=`${getSimpleBaseURL()}/api/business.js?operation=get&id=${e}`;console.log("Fetching simple business details:",s);const t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch business: ${t.status}`);return(await t.json()).result}function populateSimpleUpdateForm(e){console.log("Populating simple update form:",e),window.selectedBusinessData=e;const s=document.getElementById("business-info-section");s&&(s.style.display="block");const t=document.getElementById("selected-business-id");t&&(t.value=e._id),setSimpleFieldValue("bname",e.bname),setSimpleFieldValue("address1",e.address1),setSimpleFieldValue("address2",e.address2),setSimpleFieldValue("city",e.city),setSimpleFieldValue("zip",e.zip),setSimpleFieldValue("phone",e.phone),setSimpleSelectValue("state",e.state),setSimpleSelectValue("type",e.type),setSimpleSelectValue("status",e.status||"active"),s&&s.scrollIntoView({behavior:"smooth"}),console.log("Simple form populated successfully")}function getSimpleBaseURL(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`http://${window.location.host}`:window.location.origin}function getSimpleBusinessTypeLabel(e){return{AUTO:"Automotive",BEAU:"Beauty",BOOK:"Bookstore",CLTH:"Clothing",CONV:"Convenience Store",DEPT:"Department Store",ELEC:"Electronics",ENTR:"Entertainment",FURN:"Furniture",FUEL:"Fuel Station",GIFT:"Gift Shop",GROC:"Grocery",HARDW:"Hardware",HEAL:"Health",JEWL:"Jewelry",OTHER:"Other",RX:"Pharmacy",REST:"Restaurant",RETAIL:"Retail",SERV:"Service",SPEC:"Specialty",SPRT:"Sporting Goods",TECH:"Technology",TOYS:"Toys"}[e]||e}function setSimpleFieldValue(e,s){const t=document.getElementById(e);t&&(t.value=s||"")}function setSimpleSelectValue(e,s){const t=document.getElementById(e);if(t&&s)for(let e=0;e<t.options.length;e++)if(t.options[e].value.toLowerCase()===s.toLowerCase()){t.selectedIndex=e;break}}function showSimpleLoadingIndicator(e="Searching..."){const s=document.getElementById("business-search-results");s&&(s.innerHTML=`\n            <div class="simple-loading">\n                <div class="simple-spinner"></div>\n                <div>${e}</div>\n            </div>\n        `,s.style.display="block")}function hideSimpleLoadingIndicator(){if(console.log("Hiding simple loading indicator"),lastSuccessfulResults&&lastSuccessfulResults.length>0)restoreSimpleResultsTable();else{const e=document.getElementById("business-search-results");e&&(e.innerHTML="",e.style.display="none")}}function showSimpleErrorMessage(e){const s=document.getElementById("business-search-results");s&&(s.innerHTML=`\n            <div class="simple-error">\n                <h3>Error</h3>\n                <p>${e}</p>\n                <button onclick="clearSimpleResults()">Try Again</button>\n            </div>\n        `,s.style.display="block")}function clearSimpleResults(){const e=document.getElementById("business-search-results");e&&(e.innerHTML="",e.style.display="none");const s=document.getElementById("business-name"),t=document.getElementById("address");s&&(s.value=""),t&&(t.value="")}window.selectSimpleBusinessForUpdate=async function(e){console.log("Selecting business for simple update:",e);try{showSimpleLoadingIndicator("Loading business details...");const s=await fetchSimpleBusinessDetails(e);s?(console.log("Business details loaded successfully"),restoreSimpleResultsTable(),populateSimpleUpdateForm(s)):(hideSimpleLoadingIndicator(),alert("Error: Could not load business details."))}catch(e){console.error("Error selecting business:",e),hideSimpleLoadingIndicator(),alert("Error: "+e.message)}};