function initializeSimpleIncentiveSearch(){console.log("Initializing simple incentive search...");const e=document.getElementById("business-search-form");if(!e)return void console.error("Search form not found");e.onsubmit=null;const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),document.getElementById("business-search-form").addEventListener("submit",handleIncentiveSearch),console.log("Simple incentive search initialized successfully")}async function handleIncentiveSearch(e){e.preventDefault(),console.log("Simple incentive search: Form submitted");const n=document.getElementById("business-name")?.value||"",t=document.getElementById("address")?.value||"";if(!n.trim()&&!t.trim())return void alert("Please enter either a business name or an address to search");const s={businessName:n.trim(),address:t.trim()};console.log("Simple incentive search: Searching with",s);try{showIncentiveLoadingIndicator(),displayIncentiveSearchResults(await performSimpleIncentiveSearch(s))}catch(e){console.error("Simple incentive search error:",e),showIncentiveErrorMessage("Error searching for businesses: "+e.message)}}async function performSimpleIncentiveSearch(e){console.log("Performing simple incentive search...");try{const n=getIncentiveBaseURL(),t=new URLSearchParams;t.append("operation","search"),e.businessName&&t.append("business_name",e.businessName),e.address&&t.append("address",e.address);const s=`${n}/api/business.js?${t.toString()}`;console.log("Simple incentive search API URL:",s);const i=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json; charset=UTF-8"}});if(!i.ok)throw new Error(`Search failed: ${i.status}`);const o=((await i.json()).results||[]).filter((e=>!0!==e.is_chain||(console.log(`Filtering out parent chain: ${e.bname}`),!1)));return console.log(`Simple incentive search: Found ${o.length} businesses`),o}catch(e){throw console.error("Simple incentive search error:",e),e}}function displayIncentiveSearchResults(e){console.log(`Displaying ${e.length} businesses in incentive search results`);const n=document.getElementById("business-search-results");if(!n)return void console.error("Results container not found");if(n.innerHTML="",0===e.length)return n.innerHTML='\n            <div class="incentive-no-results">\n                <h3>No businesses found</h3>\n                <p>No businesses match your search criteria. Please try different search terms.</p>\n            </div>\n        ',void(n.style.display="block");const t=createIncentiveResultsTable(e);n.innerHTML=t,n.style.display="block",n.scrollIntoView({behavior:"smooth"}),console.log("Incentive search results displayed successfully")}function createIncentiveResultsTable(e){let n=`\n        <div class="incentive-results-container">\n            <h3>Search Results (${e.length} found)</h3>\n            <table class="incentive-results-table">\n                <thead>\n                    <tr>\n                        <th>Business Name</th>\n                        <th>Address</th>\n                        <th>Type</th>\n                        <th>Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n    `;return e.forEach((e=>{let t="";e.address1&&(t=e.address1,e.address2&&(t+=", "+e.address2),e.city&&(t+=", "+e.city),e.state&&(t+=", "+e.state),e.zip&&(t+=" "+e.zip));const s=getIncentiveBusinessTypeLabel(e.type),i=e.chain_id?'<span class="incentive-chain-badge">Chain</span>':"";let o="";const c=window.location.pathname;c.includes("incentive-view.html")?o=`\n                <button class="incentive-select-btn" onclick="selectBusinessForIncentiveView('${e._id}')">\n                    View Incentives\n                </button>\n            `:c.includes("incentive-add.html")?o=`\n                <button class="incentive-select-btn" onclick="selectBusinessForIncentiveAdd('${e._id}')">\n                    Add Incentive\n                </button>\n            `:c.includes("incentive-update.html")&&(o=`\n                <button class="incentive-select-btn" onclick="selectBusinessForIncentiveUpdate('${e._id}')">\n                    Update Incentives\n                </button>\n            `),n+=`\n            <tr class="incentive-business-row">\n                <td>${e.bname} ${i}</td>\n                <td>${t}</td>\n                <td>${s}</td>\n                <td>${o}</td>\n            </tr>\n        `})),n+="\n                </tbody>\n            </table>\n        </div>\n    ",n}async function fetchIncentiveBusinessDetails(e){const n=`${getIncentiveBaseURL()}/api/business.js?operation=get&id=${e}`;console.log("Fetching incentive business details:",n);const t=await fetch(n);if(!t.ok)throw new Error(`Failed to fetch business: ${t.status}`);return(await t.json()).result}function getIncentiveBaseURL(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`http://${window.location.host}`:window.location.origin}function getIncentiveBusinessTypeLabel(e){return{AUTO:"Automotive",BEAU:"Beauty",BOOK:"Bookstore",CLTH:"Clothing",CONV:"Convenience Store",DEPT:"Department Store",ELEC:"Electronics",ENTR:"Entertainment",FURN:"Furniture",FUEL:"Fuel Station",GIFT:"Gift Shop",GROC:"Grocery",HARDW:"Hardware",HEAL:"Health",JEWL:"Jewelry",OTHER:"Other",RX:"Pharmacy",REST:"Restaurant",RETAIL:"Retail",SERV:"Service",SPEC:"Specialty",SPRT:"Sporting Goods",TECH:"Technology",TOYS:"Toys"}[e]||e}function showIncentiveLoadingIndicator(e="Searching..."){const n=document.getElementById("business-search-results");n&&(n.innerHTML=`\n            <div class="incentive-loading">\n                <div class="incentive-spinner"></div>\n                <div class="incentive-loading-text">${e}</div>\n            </div>\n        `,n.style.display="block")}function hideIncentiveLoadingIndicator(){console.log("Hiding incentive loading indicator")}function showIncentiveErrorMessage(e){const n=document.getElementById("business-search-results");n&&(n.innerHTML=`\n            <div class="incentive-error">\n                <h3>Error</h3>\n                <p>${e}</p>\n                <button onclick="clearIncentiveResults()">Try Again</button>\n            </div>\n        `,n.style.display="block")}function clearIncentiveResults(){const e=document.getElementById("business-search-results");e&&(e.innerHTML="",e.style.display="none");const n=document.getElementById("business-name"),t=document.getElementById("address");n&&(n.value=""),t&&(t.value="")}document.addEventListener("DOMContentLoaded",(function(){console.log("Simple Incentive Search Handler Loaded!"),setTimeout((function(){initializeSimpleIncentiveSearch()}),200)})),window.selectBusinessForIncentiveView=async function(e){console.log("Selecting business for incentive view:",e);try{showIncentiveLoadingIndicator("Loading business details...");const n=await fetchIncentiveBusinessDetails(e);n?(console.log("Business details loaded for incentive view"),hideIncentiveLoadingIndicator(),"function"==typeof window.viewBusinessIncentives&&window.viewBusinessIncentives(n)):(hideIncentiveLoadingIndicator(),alert("Error: Could not load business details."))}catch(e){console.error("Error selecting business for incentive view:",e),hideIncentiveLoadingIndicator(),alert("Error: "+e.message)}},window.selectBusinessForIncentiveAdd=async function(e){console.log("Selecting business for incentive add:",e);try{showIncentiveLoadingIndicator("Loading business details...");const n=await fetchIncentiveBusinessDetails(e);n?(console.log("Business details loaded for incentive add"),hideIncentiveLoadingIndicator(),"function"==typeof window.selectBusinessForIncentive&&window.selectBusinessForIncentive(n)):(hideIncentiveLoadingIndicator(),alert("Error: Could not load business details."))}catch(e){console.error("Error selecting business for incentive add:",e),hideIncentiveLoadingIndicator(),alert("Error: "+e.message)}},window.selectBusinessForIncentiveUpdate=async function(e){console.log("Selecting business for incentive update:",e);try{showIncentiveLoadingIndicator("Loading business details...");const n=await fetchIncentiveBusinessDetails(e);n?(console.log("Business details loaded for incentive update"),hideIncentiveLoadingIndicator(),"function"==typeof window.selectBusinessForIncentives?window.selectBusinessForIncentives(n):"function"==typeof window.selectBusinessForIncentive&&window.selectBusinessForIncentive(n)):(hideIncentiveLoadingIndicator(),alert("Error: Could not load business details."))}catch(e){console.error("Error selecting business for incentive update:",e),hideIncentiveLoadingIndicator(),alert("Error: "+e.message)}};