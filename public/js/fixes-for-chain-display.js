function addCompactChainStyles(){if(!document.getElementById("compact-chain-styles")){const n=document.createElement("style");n.id="compact-chain-styles",n.textContent="\n            /* More compact styling for chain warnings */\n            .chain-business-warning,\n            .chain-incentive-warning {\n                background-color: #FFF3CD;\n                color: #856404;\n                border: 1px solid #FFEEBA;\n                padding: 8px 12px;\n                margin-bottom: 12px;\n                border-radius: 4px;\n                font-size: 0.9em;\n                max-width: 100%;\n                box-sizing: border-box;\n            }\n            \n            .chain-business-warning p,\n            .chain-incentive-warning p {\n                margin: 5px 0;\n                line-height: 1.3;\n            }\n            \n            /* Ensure single banner only */\n            .chain-business-warning + .chain-business-warning,\n            .chain-incentive-warning + .chain-incentive-warning {\n                display: none !important;\n            }\n            \n            /* Fix for extra spacing */\n            #business-info-section br + br {\n                display: none;\n            }\n            \n            /* Consistent badge styling */\n            .chain-badge {\n                background-color: #4285F4;\n                color: white;\n                border-radius: 4px;\n                padding: 2px 5px;\n                font-size: 11px;\n                display: inline-block;\n                margin-left: 5px;\n                font-weight: normal;\n            }\n            \n            .location-badge {\n                background-color: #34A853;\n                color: white;\n                border-radius: 4px;\n                padding: 2px 5px;\n                font-size: 11px;\n                display: inline-block;\n                margin-left: 5px;\n                font-weight: normal;\n            }\n        ",document.head.appendChild(n),console.log("Added compact chain styles")}}function patchBusinessFieldLookup(){if("function"==typeof window.populateBusinessInfo){console.log("Patching populateBusinessInfo function");const n=function(n){if(n){console.log("Enhanced populateBusinessInfo with:",n);try{const e=document.getElementById("bname");e&&(e.value=n.bname||"",console.log("Set bname field value:",n.bname));const s=document.getElementById("address1");s&&(s.value=n.address1||"",console.log("Set address1 field value:",n.address1));const t=document.getElementById("address2");t&&(t.value=n.address2||"",console.log("Set address2 field value:",n.address2));const i=document.getElementById("city");i&&(i.value=n.city||"",console.log("Set city field value:",n.city));const a=document.getElementById("zip");a&&(a.value=n.zip||"",console.log("Set zip field value:",n.zip));const o=document.getElementById("phone");o&&(o.value=n.phone||"",console.log("Set phone field value:",n.phone));const l=document.getElementById("state");if(l){const e=n.state||"";console.log("Setting state select to:",e);for(let n=0;n<l.options.length;n++)if(l.options[n].value===e){l.selectedIndex=n;break}}const c=document.getElementById("type");if(c){const e=n.type||"";console.log("Setting business type select to:",e);for(let n=0;n<c.options.length;n++)if(c.options[n].value===e){c.selectedIndex=n;break}}const d=document.getElementById("business-name-display");if(d){let e=n.bname||"Unknown Business";n.is_chain?e+=' <span class="chain-badge">National Chain</span>':n.chain_id&&(e+=' <span class="chain-badge">Chain Location</span>'),d.innerHTML=e,console.log("Set business-name-display:",e)}const r=document.getElementById("business-address-display");if(r){let e=n.address1||"";n.address2?e+="<br>"+n.address2:n.is_chain&&(e="<em>National Chain Headquarters</em>"),r.innerHTML=e,console.log("Set business-address-display:",e)}const p=document.getElementById("business-city-state-display");if(p){let e="";n.city&&(e+=n.city),n.state&&(e+=", "+n.state),n.zip&&(e+=" "+n.zip),p.textContent=e,console.log("Set business-city-state-display:",e)}const u=document.getElementById("business-phone-display");u&&(u.textContent=n.phone||"Not provided",console.log("Set business-phone-display:",n.phone));const h=document.getElementById("business-type-display");if(h){const e={AUTO:"Automotive",BEAU:"Beauty",BOOK:"Bookstore",CLTH:"Clothing",CONV:"Convenience Store/Gas Station",DEPT:"Department Store",ELEC:"Electronics",ENTR:"Entertainment",FURN:"Furniture",FUEL:"Fuel Station/Truck Stop",GIFT:"Gift Shop",GROC:"Grocery",HARDW:"Hardware",HEAL:"Health",HOTEL:"Hotel/Motel",JEWL:"Jewelry",OTHER:"Other",RX:"Pharmacy",REST:"Restaurant",RETAIL:"Retail",SERV:"Service",SPEC:"Specialty",SPRT:"Sporting Goods",TECH:"Technology",TOYS:"Toys"};h.textContent=e[n.type]||n.type||"Unknown",console.log("Set business-type-display:",e[n.type])}console.log("Enhanced business info populated successfully")}catch(n){console.error("Error in enhancedPopulateBusinessInfo:",n)}addChainInfoIfNeeded(n)}else console.error("No business data provided to populateBusinessInfo")};window.populateBusinessInfo=n}}function addChainInfoIfNeeded(n){if(n&&(n.chain_id||n.is_chain)){const e=document.getElementById("business-info-section");if(!e)return;const s=e.querySelector(".chain-business-warning");if(s)return console.log("Chain warning already exists, updating content"),void(n.is_chain?s.innerHTML=`\n                    <p><strong>${n.bname}</strong> is a national chain parent business.</p>\n                    <p>Chain businesses can only be modified by administrators.</p>\n                `:n.chain_id&&(s.innerHTML=`\n                    <p><strong>${n.bname}</strong> is part of the <strong>${n.chain_name||"chain"}</strong> chain.</p>\n                    <p>This location may have chain-wide incentives that apply automatically.</p>\n                `));const t=document.createElement("div");t.className="chain-business-warning",n.is_chain?t.innerHTML=`\n                <p><strong>${n.bname}</strong> is a national chain parent business.</p>\n                <p>Chain businesses can only be modified by administrators.</p>\n            `:n.chain_id&&(t.innerHTML=`\n                <p><strong>${n.bname}</strong> is part of the <strong>${n.chain_name||"chain"}</strong> chain.</p>\n                <p>This location may have chain-wide incentives that apply automatically.</p>\n            `),e.insertBefore(t,e.firstChild)}}function preventDuplicateChainBanners(){const n=setInterval((()=>{if(document.getElementById("incentives-section")){const e=document.querySelectorAll(".chain-incentive-warning, .chain-business-warning");if(e.length>1){console.log("Found multiple chain warnings, removing duplicates");for(let n=1;n<e.length;n++)e[n].remove()}clearInterval(n)}}),500);setTimeout((()=>clearInterval(n)),5e3)}function createDetailedBusinessDisplay(n){if(!n)return;const e=document.getElementById("business-info-section");if(!e)return;if(e.querySelector(".business-details"))return;const s=e.querySelectorAll("input, select, textarea, br, label");s.length>0&&s.forEach((n=>{n.style.display="none"}));const t=document.createElement("div");t.className="business-details",t.innerHTML=`\n        <div class="detail-row">\n            <span class="detail-label">Business Name:</span>\n            <span id="business-name-display" class="detail-value">${n.bname||""}</span>\n        </div>\n        <div class="detail-row">\n            <span class="detail-label">Address:</span>\n            <span id="business-address-display" class="detail-value">${n.address1||""}</span>\n        </div>\n        <div class="detail-row">\n            <span class="detail-label">City, State Zip:</span>\n            <span id="business-city-state-display" class="detail-value">${n.city||""}, ${n.state||""} ${n.zip||""}</span>\n        </div>\n        <div class="detail-row">\n            <span class="detail-label">Phone:</span>\n            <span id="business-phone-display" class="detail-value">${n.phone||""}</span>\n        </div>\n        <div class="detail-row">\n            <span class="detail-label">Type:</span>\n            <span id="business-type-display" class="detail-value">${getBusinessTypeLabel(n.type)||""}</span>\n        </div>\n    `;const i=t.querySelector("#business-name-display");i&&(n.is_chain?i.innerHTML+=' <span class="chain-badge">National Chain</span>':n.chain_id&&(i.innerHTML+=' <span class="chain-badge">Chain Location</span>')),e.appendChild(t),addChainInfoIfNeeded(n)}function getBusinessTypeLabel(n){return{AUTO:"Automotive",BEAU:"Beauty",BOOK:"Bookstore",CLTH:"Clothing",CONV:"Convenience Store/Gas Station",DEPT:"Department Store",ELEC:"Electronics",ENTR:"Entertainment",FURN:"Furniture",FUEL:"Fuel Station/Truck Stop",GIFT:"Gift Shop",GROC:"Grocery",HARDW:"Hardware",HEAL:"Health",HOTEL:"Hotel/Motel",JEWL:"Jewelry",OTHER:"Other",RX:"Pharmacy",REST:"Restaurant",RETAIL:"Retail",SERV:"Service",SPEC:"Specialty",SPRT:"Sporting Goods",TECH:"Technology",TOYS:"Toys"}[n]||n}document.addEventListener("DOMContentLoaded",(function(){console.log("Loading fixes for chain business display"),addCompactChainStyles(),patchBusinessFieldLookup(),preventDuplicateChainBanners()}));const path=window.location.pathname;path.includes("incentive-view.html")&&window.addEventListener("load",(function(){if(console.log("Adding detailed business view fix"),window.selectedBusinessData||window.lastSelectedBusiness){const n=window.selectedBusinessData||window.lastSelectedBusiness;setTimeout((()=>{console.log("Creating detailed business display"),createDetailedBusinessDisplay(n)}),300)}}));