document.addEventListener("DOMContentLoaded",(function(){console.log("Password reset script loaded");const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`http://${window.location.host}`:"https://patriotthanks.vercel.app",t=document.getElementById("forgot-password-form");t&&(console.log("Forgot password form detected"),t.addEventListener("submit",(function(o){o.preventDefault();const n=document.getElementById("email").value,s=document.getElementById("success-alert"),l=document.getElementById("error-alert");s.style.display="none",l.style.display="none";const a=t.querySelector('input[type="submit"]');a.disabled=!0,a.value="Sending...",fetch(`${e}/api/auth.js?operation=forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n})}).then((e=>{if(!e.ok&&200!==e.status)throw new Error("Server error");return e.json()})).then((e=>{s.style.display="block",t.reset(),e.resetLink&&console.log("Reset link:",e.resetLink)})).catch((e=>{console.error("Error:",e),l.textContent="There was a problem sending the reset link. Please try again.",l.style.display="block"})).finally((()=>{a.disabled=!1,a.value="Send Reset Link"}))})));const o=document.getElementById("reset-password-form");if(o){console.log("Reset password form detected");const t=new URLSearchParams(window.location.search).get("token");t?document.getElementById("reset-token").value=t:(document.getElementById("token-missing-alert").style.display="block",o.style.display="none");const n=document.getElementById("login-link");n&&n.addEventListener("click",(function(e){e.preventDefault(),window.location.href="index.html?login=true"})),o.addEventListener("submit",(function(t){t.preventDefault();const n=document.getElementById("reset-token").value,s=document.getElementById("psw").value,l=document.getElementById("psw_repeat").value,a=document.getElementById("success-alert"),r=document.getElementById("error-alert");if(a.style.display="none",r.style.display="none",s!==l)return r.textContent="Passwords do not match.",void(r.style.display="block");if(window.validatePassword&&!window.validatePassword(s).isValid)return r.textContent="Password does not meet all requirements.",void(r.style.display="block");const d=document.getElementById("submit");d.disabled=!0,d.value="Resetting...",fetch(`${e}/api/auth.js?operation=reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,password:s})}).then((e=>e.ok?e.json():e.json().then((e=>{throw new Error(e.message||"Failed to reset password")})))).then((e=>{a.style.display="block",o.style.display="none"})).catch((e=>{console.error("Error:",e),r.textContent=e.message||"There was a problem resetting your password. The link may be invalid or expired.",r.style.display="block"})).finally((()=>{d.disabled=!1,d.value="Reset Password"}))}))}}));