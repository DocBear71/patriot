$((function(){console.log("Terms modal control loaded"),window.checkTermsVersion=function(e){if(e&&e.user&&(!e.user.termsAccepted||"May 14, 2025"!==e.user.termsVersion)){console.log("User needs to accept terms");try{if("undefined"!=typeof bootstrap&&bootstrap.Modal){const e=document.getElementById("termsUpdateModal");new bootstrap.Modal(e).show()}}catch(e){console.error("Error showing modal:",e)}}},window.updateTermsAcceptance=function(e){e.user.termsAccepted=!0,e.user.termsAcceptedDate=(new Date).toISOString(),e.user.termsVersion="May 14, 2025",localStorage.setItem("patriotThanksSession",JSON.stringify(e));const o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`http://${window.location.host}`:window.location.origin;fetch(`${o}/api/auth.js?operation=update-terms-acceptance`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.token},body:JSON.stringify({userId:e.user._id,termsAccepted:!0,termsAcceptedDate:(new Date).toISOString(),termsVersion:"May 14, 2025"})}).then((e=>e.json())).then((e=>{console.log("Terms acceptance updated on server")})).catch((e=>{console.error("Error updating terms on server:",e)}));try{const e=document.getElementById("termsUpdateModal"),o=bootstrap.Modal.getInstance(e);o&&o.hide()}catch(e){$(".modal-backdrop").remove(),$("body").removeClass("modal-open"),$("body").css("padding-right","")}},$(document).ready((function(){$("#confirmUpdatedTerms").on("click",(function(){const e=localStorage.getItem("patriotThanksSession");if(e){const o=JSON.parse(e);updateTermsAcceptance(o)}})),$("#termsSummary").on("scroll",(function(){const e=$(this)[0];e.scrollHeight-e.scrollTop<=e.clientHeight+50&&($("#acceptUpdatedTerms").prop("disabled",!1),$("#scrollMessage").css("display","block").html('<i class="bi bi-check-circle"></i> You\'ve reviewed the terms. Please check the box below to confirm your acceptance.').css("color","green"))})),$("#acceptUpdatedTerms").on("change",(function(){$("#confirmUpdatedTerms").prop("disabled",!this.checked)})),$("#rejectUpdatedTerms").on("click",(function(){confirm("If you do not accept the updated terms, you will be logged out and unable to use the service. Continue?")&&(localStorage.removeItem("patriotThanksSession"),localStorage.removeItem("isLoggedIn"),location.reload())}))}))}));