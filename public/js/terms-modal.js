document.addEventListener("DOMContentLoaded",(function(){console.log("Terms modal control loaded"),window.checkTermsVersion=function(e){e&&e.user&&(e.user.termsAccepted&&"May 14, 2025"===e.user.termsVersion||(console.log("User needs to accept terms"),ModalManager.show("termsUpdateModal",{backdrop:"static",keyboard:!1,emergencyReset:!0,resetDelay:8e3})))},window.updateTermsAcceptance=function(e){e.user.termsAccepted=!0,e.user.termsAcceptedDate=(new Date).toISOString(),e.user.termsVersion="May 14, 2025",localStorage.setItem("patriotThanksSession",JSON.stringify(e));const t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`http://${window.location.host}`:window.location.origin;fetch(`${t}/api/auth.js?operation=update-terms-acceptance`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.token},body:JSON.stringify({userId:e.user._id,termsAccepted:!0,termsAcceptedDate:(new Date).toISOString(),termsVersion:"May 14, 2025"})}).then((e=>e.json())).then((e=>{console.log("Terms acceptance updated on server")})).catch((e=>{console.error("Error updating terms on server:",e)})),ModalManager.hide("termsUpdateModal")},setTimeout((function(){const e=document.getElementById("confirmUpdatedTerms");e&&e.addEventListener("click",(function(){const e=localStorage.getItem("patriotThanksSession");if(e){const t=JSON.parse(e);updateTermsAcceptance(t)}}));const t=document.getElementById("termsSummary");t&&t.addEventListener("scroll",(function(){if(this.scrollHeight-this.scrollTop<=this.clientHeight+50){const e=document.getElementById("acceptUpdatedTerms");e&&(e.disabled=!1);const t=document.getElementById("scrollMessage");t&&(t.style.display="block",t.innerHTML='<i class="bi bi-check-circle"></i> You\'ve reviewed the terms. Please check the box below to confirm your acceptance.',t.style.color="green")}}));const o=document.getElementById("acceptUpdatedTerms");o&&o.addEventListener("change",(function(){const e=document.getElementById("confirmUpdatedTerms");e&&(e.disabled=!this.checked)}));const n=document.getElementById("rejectUpdatedTerms");n&&n.addEventListener("click",(function(){confirm("If you do not accept the updated terms, you will be logged out and unable to use the service. Continue?")&&(localStorage.removeItem("patriotThanksSession"),localStorage.removeItem("isLoggedIn"),location.reload())}))}),500)}));