let lastValidSelection="",isAdminVerified=!1;window.isAdminVerified=function(){return console.log("IsAdminVerified function called, returning: ",isAdminVerified),isAdminVerified},window.adminVerified=!1,document.addEventListener("DOMContentLoaded",(function(){console.log("Pin validation loaded!"),document.getElementById("membership-level").addEventListener("change",(function(){!function(e){const n=e.options[e.selectedIndex];"true"===n.dataset.restricted?(console.log("Restricted option selected: ",n.value),$("#adminAccessModal").modal("show"),document.getElementById("adminPinCode").value="",document.getElementById("pinError").style.display="none",""===lastValidSelection&&(lastValidSelection=e.options[0].value),e.value=lastValidSelection):(lastValidSelection=e.value,"Admin"!==n.value&&(isAdminVerified=!1,window.adminVerified=!1))}(this)})),document.getElementById("verifyPinBtn").addEventListener("click",(function(){const e=document.getElementById("adminPinCode").value,n=document.getElementById("pinError"),t=document.getElementById("membership-level");if(!e||""===e.trim())return n.style.display="block",void(n.textContent="Please enter an admin access code");console.log("Verifying pin:",e);const i=function(){try{const e=localStorage.getItem("patriotThanksSession");if(e)return JSON.parse(e).user._id}catch(e){console.error("Error getting user ID from session:",e)}return null}(),o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`http://${window.location.host}`:"https://patriotthanks.vercel.app",s={code:e,userId:i},d=document.getElementById("verifyPinBtn"),a=d.textContent;d.textContent="Verifying...",d.disabled=!0,fetch(`${o}/api/auth.js?operation=verify-admin`,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(s)}).then((e=>{if(!e.ok)throw new Error("Verification failed");return e.json()})).then((e=>{e.access?(t.value="Admin",lastValidSelection="Admin",isAdminVerified=!0,window.adminVerified=!0,$("#adminAccessModal").modal("hide"),console.log("Admin access verified successfully!"),alert(e.message||"Admin access verified successfully!"),function(e){if(e)try{const e=localStorage.getItem("patriotThanksSession");if(e){const n=JSON.parse(e);n.user.status="AD",n.user.isAdmin=!0,localStorage.setItem("patriotThanksSession",JSON.stringify(n)),console.log("User session updated with admin status")}}catch(e){console.error("Error updating user session:",e)}}(i)):(n.style.display="block",n.textContent=e.message||"Invalid admin access code",console.log("Invalid admin code entered"))})).catch((e=>{console.error("Admin verification error:",e),n.style.display="block",n.textContent="Error verifying admin code: "+e.message})).finally((()=>{d.textContent=a,d.disabled=!1}))}))}));