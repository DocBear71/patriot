$((function(){function e(){console.log("Setting up simplified scroll tracking");const e=document.getElementById("termsSummary"),o=document.getElementById("acceptUpdatedTerms"),t=document.getElementById("scrollMessage");if(!e||!o)return void console.error("Required elements not found for scroll tracking");let n=!1,s=Date.now();$(e).off("scroll"),$(e).on("scroll",(function(){const l=e.scrollTop+e.clientHeight,c=e.scrollHeight,r=Date.now()-s,i=l/c*100;console.log(`Scroll position: ${l}/${c} (${i.toFixed(2)}%)`),i>=80&&r>=5e3&&(console.log("User has scrolled to near bottom of terms"),n=!0,o.disabled=!1,t&&(t.style.display="block",t.innerHTML='<i class="bi bi-check-circle"></i> Thank you for reviewing the terms. Please check the box below to confirm your acceptance.',t.style.color="green"))})),$(o).off("change"),$(o).on("change",(function(){if(!n&&this.checked)return alert("Please read the terms summary by scrolling to the bottom before accepting."),void(this.checked=!1);const e=document.getElementById("confirmUpdatedTerms");e&&(e.disabled=!this.checked)})),setTimeout((function(){e.scrollHeight<=e.clientHeight?(console.log("Content fits without scrolling - enabling checkbox directly"),o.disabled=!1,n=!0,t&&(t.style.display="block",t.innerHTML='<i class="bi bi-check-circle"></i> Thank you for reviewing the terms. Please check the box below to confirm your acceptance.',t.style.color="green")):(e.scrollTop=1,$(e).trigger("scroll"))}),500)}function o(){console.log("Setting up simplified modal buttons");const e=document.getElementById("confirmUpdatedTerms"),o=document.getElementById("rejectUpdatedTerms");e&&o?($(e).off("click"),$(o).off("click"),$(e).on("click",(function(e){e.preventDefault(),console.log("Confirm button clicked");const o=localStorage.getItem("patriotThanksSession");if(!o)return console.error("No session found"),void t();try{const e=JSON.parse(o);e.user.termsAccepted=!0,e.user.termsAcceptedDate=(new Date).toISOString(),e.user.termsVersion="May 14, 2025",localStorage.setItem("patriotThanksSession",JSON.stringify(e)),t(),"function"==typeof updateTermsAcceptance?updateTermsAcceptance(e):console.log("updateTermsAcceptance function not available - only updated locally")}catch(e){console.error("Error parsing session data:",e),t()}})),$(o).on("click",(function(e){e.preventDefault(),console.log("Reject button clicked"),confirm("If you do not accept the updated terms, you will be logged out and unable to use the service. Continue?")&&("function"==typeof logoutUser?logoutUser():(console.error("Logout function not available"),localStorage.removeItem("patriotThanksSession"),localStorage.removeItem("isLoggedIn")),t())})),$(".modal .btn-close").off("click").on("click",(function(e){e.preventDefault(),console.log("Close button clicked"),t()})),$(document).off("keydown.terms").on("keydown.terms",(function(e){"Escape"===e.key&&(console.log("Escape key pressed"),t())}))):console.error("Button elements not found")}function t(){console.log("Hiding modal with simplified method");try{if("undefined"!=typeof bootstrap&&bootstrap.Modal){const e=document.getElementById("termsUpdateModal"),o=bootstrap.Modal.getInstance(e);if(o)return void o.hide()}}catch(e){console.error("Error using Bootstrap 5 to hide modal:",e)}const e=document.getElementById("termsUpdateModal");$(e).removeClass("show"),$(e).css("display","none"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$("body").css("padding-right",""),$("body").css("overflow","")}console.log("Simplified Bootstrap 5 Terms Modal initialized"),window.originalCheckTermsVersion=window.checkTermsVersion,window.checkTermsVersion=function(t){if(console.log("Simple terms version check called"),t&&t.user&&(!t.user.termsAccepted||"May 14, 2025"!==t.user.termsVersion)){console.log("User needs to accept new terms - using simplified implementation"),$(".modal-backdrop").remove(),$("body").removeClass("modal-open"),$("body").css("padding-right",""),e(),o();try{if("undefined"!=typeof bootstrap&&bootstrap.Modal){const e=document.getElementById("termsUpdateModal");new bootstrap.Modal(e,{backdrop:"static",keyboard:!1}).show(),console.log("Modal shown using Bootstrap 5 Modal constructor")}else $("#termsUpdateModal").addClass("show"),$("#termsUpdateModal").css("display","block"),$("body").addClass("modal-open"),$("body").append('<div class="modal-backdrop show"></div>'),console.log("Modal shown using fallback method")}catch(e){console.error("Error showing modal:",e),showEmergencyButton()}setTimeout((function(){const e=$("#termsUpdateModal").is(":visible"),o=$("#termsUpdateModal").find(".modal-content").is(":visible");e&&!o&&(console.log("Modal may be stuck - showing emergency reset button"),showEmergencyButton())}),5e3)}},window.showEmergencyButton=function(){console.log("Showing emergency button");let e=document.getElementById("emergencyResetBtn");e||(e=document.createElement("button"),e.id="emergencyResetBtn",e.innerHTML="Emergency Reset",e.style.position="fixed",e.style.bottom="10px",e.style.right="10px",e.style.zIndex="9999",e.style.backgroundColor="#dc3545",e.style.color="white",e.style.border="none",e.style.padding="8px 15px",e.style.borderRadius="4px",e.style.fontWeight="bold",e.style.cursor="pointer",e.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",e.addEventListener("click",(function(){console.log("Emergency reset button clicked"),"function"==typeof emergencyModalReset?emergencyModalReset():t(),this.style.display="none"})),document.body.appendChild(e)),e.style.display="block"},window.emergencyModalReset=function(){console.log("Emergency modal reset called"),t();const e=document.getElementById("emergencyResetBtn");return e&&(e.style.display="none"),!0},window.hideSimpleModal=t,window.setupSimpleScrollTracking=e,window.setupSimpleModalButtons=o}));