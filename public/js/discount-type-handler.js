function updateInfoWindowIncentiveDisplay(e,t){const n=document.getElementById(t);if(!n)return;if(!e||0===e.length)return void(n.innerHTML="<p><strong>Incentives:</strong> No incentives found</p>");let o='<p><strong>Incentives:</strong></p><ul class="incentives-list">';e.forEach((e=>{if(e.is_available){const t=getIncentiveTypeLabel(e.type),n=e.other_description?` (${e.other_description})`:"";let i;i="amount"===e.discount_type?`$${parseFloat(e.amount).toFixed(2)}`:`${e.amount}%`,o+=`\n                <li>\n                    <strong>${t}${n}:</strong> ${i}\n                    ${e.information?` - ${e.information}`:""}\n                </li>\n            `}})),o+="</ul>",n.innerHTML='<p><strong>Incentives:</strong></p><ul class="incentives-list"></ul>'===o?"<p><strong>Incentives:</strong> No active incentives found</p>":o}function getIncentiveTypeLabel(e){return{VT:"Veteran",AD:"Active-Duty",FR:"First Responder",SP:"Spouse",OT:"Other"}[e]||e}document.addEventListener("DOMContentLoaded",(function(){if(console.log("Discount Type Handler Loaded!"),!document.getElementById("discountTypeContainer")){const a=document.querySelector(".form-group:has(#incentiveAmount)");if(a){const u=document.createElement("div");u.className="form-group",u.id="discountTypeContainer",u.innerHTML='\n                <label>Discount Type <span class="required-indicator">*</span></label>\n                <div class="radio-group">\n                    <label for="discountTypePercentage">Percentage (%)</label>\n                    <input type="radio" id="discountTypePercentage" name="discountType" value="percentage" checked>\n                </div>\n                <div class="radio-group">\n                    <label for="discountTypeDollar">Dollar Amount ($)</label>\n                    <input type="radio" id="discountTypeDollar" name="discountType" value="dollar">\n                </div>\n            ',a.parentNode.insertBefore(u,a)}}const e=document.querySelector('label[for="incentiveAmount"]');e&&!e.id&&(e.id="amountLabel");const t=document.getElementById("discountTypePercentage"),n=document.getElementById("discountTypeAmount"),o=document.getElementById("incentiveAmountLabel"),i=document.getElementById("incentiveAmount");if(t&&n&&o&&i){function c(){t.checked?(o.textContent="Incentive Amount as a % *",i.setAttribute("min","0"),i.setAttribute("max","100"),i.setAttribute("step","0.1"),i.setAttribute("placeholder","Enter percentage (e.g. 10 for 10%)")):(o.textContent="Incentive Amount in $ *",i.setAttribute("min","0"),i.setAttribute("max","1000"),i.setAttribute("step","0.01"),i.setAttribute("placeholder","Enter dollar amount (e.g. 0.10 for $0.10)"))}t.addEventListener("change",c),n.addEventListener("change",c),c()}window.isValidNumber=function(e){const t=parseFloat(e);if(isNaN(t)||t<=0)return!1;const n=document.getElementById("discountTypePercentage");return!n||!n.checked||t<=100};const r=window.addIncentive||null;window.addIncentive=function(e){console.log("Adding Incentive with discount type: ",e);const t=document.getElementById("discountTypePercentage");if(e.discount_type=t?t.checked?"percentage":"amount":"percentage","function"==typeof r)return r(e);const n=localStorage.getItem("patriotThanksSession");if(n){const t=JSON.parse(n);t&&t.user&&t.user._id&&(e.created_by=t.user._id)}const o=document.querySelector('#incentive-form input[type="submit"]');let i="Submit Incentive";o&&(i=o.value,o.value="Submitting...",o.disabled=!0);const c=`${window.location.origin}/api/combined-api.js?operation=incentives`;console.log("Attempting to submit to: ",c),fetch(c,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(e)}).then((e=>(console.log("response status:",e.status),console.log("response Headers:",[...e.headers.entries()]),e.ok?e.json():e.text().then((t=>{throw console.log("Error response body: ",t),new Error(`Server responded with status ${e.status}`)}))))).then((e=>{console.log("Incentive added successfully: ",e),alert("Incentive added successfully!"),"function"==typeof resetForm&&resetForm()})).catch((e=>{console.error("Error adding incentive: ",e),alert(`Error adding incentive: ${e.message}`)})).finally((()=>{o&&(o.value=i,o.disabled=!1)}))};const s=window.resetForm||null;window.resetForm=function(){"function"==typeof s&&s();const e=document.getElementById("discountTypePercentage");e&&(e.checked=!0);const t=document.getElementById("discountTypeAmount");t&&(t.checked=!1);const n=document.getElementById("incentiveAmountLabel"),o=document.getElementById("incentiveAmount");n&&o&&(n.textContent="Incentive Amount as a % *",o.setAttribute("min","0"),o.setAttribute("max","100"),o.setAttribute("step","0.1"),o.setAttribute("placeholder","Enter percentage (e.g. 10 for 10%)"))};const d=document.getElementById("incentive-form");if(d){const l=d.cloneNode(!0);d.parentNode.replaceChild(l,d),l.addEventListener("submit",(function(e){if(e.preventDefault(),"function"==typeof validateIncentiveForm&&!validateIncentiveForm())return;const t=document.getElementById("selected-business-id"),n=t?t.value:"",o=document.getElementById("incentiveAvailable").checked,i=document.getElementById("incentiveType"),c=i?i.value:"",r=document.getElementById("incentiveAmount"),s=r?r.value:"",d=document.getElementById("incentiveInfo"),a=d?d.value:"",u=document.getElementById("discountTypePercentage"),l={business_id:n,is_available:o,type:c,amount:s,information:a,discount_type:u&&u.checked?"percentage":"amount"};if("OT"===c){const e=document.getElementById("otherTypeDescription")?.value||"";l.other_description=e}"function"==typeof addIncentive?addIncentive(l):(console.error("addIncentive function not found"),alert("Error: Could not submit the incentive. Please try again later."))}))}}));