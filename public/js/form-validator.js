document.addEventListener("DOMContentLoaded",(function(){const e={firstName:document.getElementById("fname"),lastName:document.getElementById("lname"),address1:document.getElementById("address1"),city:document.getElementById("city"),state:document.getElementById("state"),zip:document.getElementById("zip"),email:document.getElementById("email"),status:document.getElementById("status"),level:document.getElementById("membership-level")};function t(e){return""!==e.trim()}function a(e){return/^\d{5}(-\d{4})?$/.test(e)}function i(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function n(e,t){t(e.value)?(e.classList.remove("invalid-field"),e.classList.add("valid-field"),e.setAttribute("data-valid","true")):(e.classList.remove("valid-field"),e.classList.add("invalid-field"),e.setAttribute("data-valid","false"))}document.getElementById("register-form").addEventListener("submit",(function(n){n.preventDefault();const s=[];t(e.firstName.value)||s.push("First Name"),t(e.lastName.value)||s.push("Last Name"),t(e.address1.value)||s.push("Address"),t(e.city.value)||s.push("City"),t(e.state.value)||s.push("State"),a(e.zip.value)||s.push("Zip Code"),i(e.email.value)||s.push("Email"),t(e.status.value)||s.push("Status"),t(e.level.value)||s.push("Membership Level");const l=document.getElementById("match");if(l&&!l.classList.contains("valid")&&s.push("Password (must meet all requirements and match)"),"Admin"===e.level.value&&!0!==window.adminVerified)return s.push("Admin access code verification"),void alert("Admin access must be verified with a valid code before registration");if(e.level.value,s.length>0){let e="Please complete the following required fields:\n";e+=s.join("\n"),alert(e)}else!async function(e){try{const t=`${window.location.origin}/api/auth.js?operation=register`,a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)});if(!a.ok){const e=await a.text();throw new Error(`Failed to submit data to MongoDB: ${a.status} ${e}`)}await a.json(),alert("Registration successful! You can now log in."),window.location.href="../index.html"}catch(e){alert("Registration failed: "+e.message)}}({fname:e.firstName.value,lname:e.lastName.value,address1:e.address1.value,address2:document.getElementById("address2").value,city:e.city.value,state:e.state.value,zip:e.zip.value,status:e.status.value,level:e.level.value,email:e.email.value.toLowerCase(),password:document.getElementById("psw").value,psw_repeat:document.getElementById("psw_repeat").value})})),e.firstName.addEventListener("input",(function(){n(this,t)})),e.lastName.addEventListener("input",(function(){n(this,t)})),e.address1.addEventListener("input",(function(){n(this,t)})),e.city.addEventListener("input",(function(){n(this,t)})),e.state.addEventListener("change",(function(){n(this,t)})),e.zip.addEventListener("input",(function(){n(this,a)})),e.email.addEventListener("input",(function(){n(this,i)})),e.status.addEventListener("change",(function(){n(this,t)})),e.level.addEventListener("change",(function(){n(this,t),"Admin"!==this.value&&(window.adminVerified=!1)})),function(){const n=[{element:e.firstName,validator:t},{element:e.lastName,validator:t},{element:e.address1,validator:t},{element:e.city,validator:t},{element:e.state,validator:t},{element:e.zip,validator:a},{element:e.email,validator:i},{element:e.status,validator:t},{element:e.level,validator:t}];let s=!0;n.forEach((e=>{e.validator(e.element.value)?(e.element.classList.remove("invalid-field"),e.element.classList.add("valid-field")):(s=!1,e.element.classList.remove("valid-field"),e.element.classList.add("invalid-field"))}))}(),function(){["fname","lname","address1","city","state","zip","email","status","membership-level"].forEach((e=>{if(document.getElementById(e)){const t=document.querySelector(`label[for="${e}"]`);if(t&&!t.innerHTML.includes("*")){const e=document.createElement("span");e.className="required-indicator",e.textContent=" *",e.style.color="red",t.appendChild(e)}}}));const e=document.getElementById("register-form");if(e){const t=document.createElement("div");t.className="form-explanation",t.innerHTML="<p>Fields marked with an asterisk (*) are required.</p>",e.insertBefore(t,e.firstChild)}}()}));