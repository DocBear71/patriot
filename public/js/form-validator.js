document.addEventListener("DOMContentLoaded",(function(){const e={firstName:document.getElementById("fname"),lastName:document.getElementById("lname"),address1:document.getElementById("address1"),city:document.getElementById("city"),state:document.getElementById("state"),zip:document.getElementById("zip"),email:document.getElementById("email"),status:document.getElementById("status"),level:document.getElementById("membership-level"),termsCheckbox:document.getElementById("terms-checkbox")};function t(e){return""!==e.trim()}function a(e){return/^\d{5}(-\d{4})?$/.test(e)}function n(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function s(e,t){t(e.value)?(e.classList.remove("invalid-field"),e.classList.add("valid-field"),e.setAttribute("data-valid","true")):(e.classList.remove("valid-field"),e.classList.add("invalid-field"),e.setAttribute("data-valid","false"))}document.getElementById("register-form").addEventListener("submit",(function(s){s.preventDefault();const i=[];t(e.firstName.value)||i.push("First Name"),t(e.lastName.value)||i.push("Last Name"),t(e.address1.value)||i.push("Address"),t(e.city.value)||i.push("City"),t(e.state.value)||i.push("State"),a(e.zip.value)||i.push("Zip Code"),n(e.email.value)||i.push("Email"),t(e.status.value)||i.push("Status"),t(e.level.value)||i.push("Membership Level"),e.termsCheckbox.checked?document.getElementById("terms-error").style.display="none":(i.push("Terms and Conditions agreement"),document.getElementById("terms-error").style.display="block"),!e.termsCheckbox||(e.termsCheckbox.checked?(e.termsCheckbox.classList.remove("invalid-field"),e.termsCheckbox.classList.add("valid-field"),document.getElementById("terms-error").style.display="none",1):(e.termsCheckbox.classList.remove("valid-field"),e.termsCheckbox.classList.add("invalid-field"),document.getElementById("terms-error").style.display="block",0))||i.push("Terms and Conditions acceptance");const l=document.getElementById("match");if(l&&!l.classList.contains("valid")&&i.push("Password (must meet all requirements and match)"),"Admin"===e.level.value&&!0!==window.adminVerified)return i.push("Admin access code verification"),void alert("Admin access must be verified with a valid code before registration");if(e.level.value,i.length>0){let e="Please complete the following required fields:\n";e+=i.join("\n"),alert(e)}else!async function(e){try{const t=`${window.location.origin}/api/auth.js?operation=register`,a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)});if(!a.ok){const e=await a.text();throw new Error(`Failed to submit data to MongoDB: ${a.status} ${e}`)}await a.json(),alert("Registration successful! You can now log in."),window.location.href="../index.html"}catch(e){alert("Registration failed: "+e.message)}}({fname:e.firstName.value,lname:e.lastName.value,address1:e.address1.value,address2:document.getElementById("address2").value,city:e.city.value,state:e.state.value,zip:e.zip.value,status:e.status.value,level:e.level.value,email:e.email.value.toLowerCase(),password:document.getElementById("psw").value,psw_repeat:document.getElementById("psw_repeat").value,termsAccepted:!!e.termsCheckbox&&e.termsCheckbox.checked,termsAcceptedDate:(new Date).toISOString(),termsVersion:"May 14, 2025"})})),e.firstName.addEventListener("input",(function(){s(this,t)})),e.lastName.addEventListener("input",(function(){s(this,t)})),e.address1.addEventListener("input",(function(){s(this,t)})),e.city.addEventListener("input",(function(){s(this,t)})),e.state.addEventListener("change",(function(){s(this,t)})),e.zip.addEventListener("input",(function(){s(this,a)})),e.email.addEventListener("input",(function(){s(this,n)})),e.status.addEventListener("change",(function(){s(this,t)})),e.level.addEventListener("change",(function(){s(this,t),"Admin"!==this.value&&(window.adminVerified=!1)})),function(){const s=[{element:e.firstName,validator:t},{element:e.lastName,validator:t},{element:e.address1,validator:t},{element:e.city,validator:t},{element:e.state,validator:t},{element:e.zip,validator:a},{element:e.email,validator:n},{element:e.status,validator:t},{element:e.level,validator:t}];let i=!0;s.forEach((e=>{e.validator(e.element.value)?(e.element.classList.remove("invalid-field"),e.element.classList.add("valid-field")):(i=!1,e.element.classList.remove("valid-field"),e.element.classList.add("invalid-field"))}))}(),function(){["fname","lname","address1","city","state","zip","email","status","membership-level"].forEach((e=>{if(document.getElementById(e)){const t=document.querySelector(`label[for="${e}"]`);if(t&&!t.innerHTML.includes("*")){const e=document.createElement("span");e.className="required-indicator",e.textContent=" *",e.style.color="red",t.appendChild(e)}}}));const e=document.getElementById("register-form");if(e){const t=document.createElement("div");t.className="form-explanation",t.innerHTML="<p>Fields marked with an asterisk (*) are required.</p>",e.insertBefore(t,e.firstChild)}}(),function(){const e=document.getElementById("membership-level");if(e){e.querySelectorAll('option:not([value="Free"]):not([value="Admin"]):not([value="Test"])').forEach((e=>{e.textContent=e.textContent+" (Coming Soon)",e.disabled=!0,e.title="This membership level will be available soon"}));const t=e.parentElement,a=document.createElement("div");a.className="premium-note",a.innerHTML='<p><small>Premium access levels will be available soon. You can support the site through <a href="donate.html">donations</a>.</small></p>',t.appendChild(a)}}()}));