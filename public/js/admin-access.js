document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("status");e&&e.addEventListener("change",(function(){"AD"===this.value?($("#adminAccessModal").modal("show"),this.value=this.dataset.lastValue||""):this.dataset.lastValue=this.value}));const t=document.getElementById("verifyPinBtn");t&&t.addEventListener("click",(async function(){const t=document.getElementById("adminPinCode").value,a=document.getElementById("pinError");a.style.display="none";try{let n=null;const s=localStorage.getItem("patriotThanksSession");s&&(n=JSON.parse(s).user._id);const i=window.location.origin,o=await fetch(`${i}/api/auth.js?operation=verify-admin`,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({code:t,userId:n})}),d=await o.json();if(o.ok&&d.access){if(e.value="AD",e.dataset.lastValue="AD",$("#adminAccessModal").modal("hide"),alert("Admin access granted: "+d.description),s){const e=JSON.parse(s);e.user.status="AD",e.user.isAdmin=!0,localStorage.setItem("patriotThanksSession",JSON.stringify(e))}}else a.textContent=d.message||"Invalid access code. Please try again.",a.style.display="block"}catch(e){console.error("Admin verification error:",e),a.textContent="Verification failed. Please try again.",a.style.display="block"}}))}));