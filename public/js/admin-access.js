document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("status");e&&e.addEventListener("change",(function(){"AD"===this.value?($("#adminAccessModal").modal("show"),this.value=this.dataset.lastValue||""):this.dataset.lastValue=this.value}));const t=document.getElementById("verifyPinBtn");t&&t.addEventListener("click",(async function(){const t=document.getElementById("adminPinCode").value,a=document.getElementById("pinError");a.style.display="none";try{let s=null;const n=localStorage.getItem("patriotThanksSession");n&&(s=JSON.parse(n).user._id);const i=await fetch("https://patriotthanks.vercel.app/api/auth.js?operation=verify-admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,userId:s})}),o=await i.json();if(i.ok&&o.access){if(e.value="AD",e.dataset.lastValue="AD",$("#adminAccessModal").modal("hide"),alert("Admin access granted: "+o.description),n){const e=JSON.parse(n);e.user.status="AD",e.user.isAdmin=!0,localStorage.setItem("patriotThanksSession",JSON.stringify(e))}}else a.textContent=o.message||"Invalid access code. Please try again.",a.style.display="block"}catch(e){console.error("Admin verification error:",e),a.textContent="Verification failed. Please try again.",a.style.display="block"}}))}));