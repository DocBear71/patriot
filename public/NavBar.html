<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/index.html">
        <img src="./images/docbearlogov4.png" width="50" height="50" alt=""/>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent1"
            aria-controls="navbarSupportedContent1" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon">
        </span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent1">
        <ul id="menu" class="navbar-nav mr-auto">
            <li class="nav-item"> <a class="nav-link" href="./index.html">Home </a> </li>
            <li class="nav-item"> <a class="nav-link" href="./about.html">About</a> </li>
            <li class="nav-item"> <a class="nav-link" href="./contact.html" >Contact Us </a></li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdownLegal" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Legal Menu </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownLegal">
                    <a class="dropdown-item" href="./privacy.html">Privacy Policy</a>
                    <a class="dropdown-item" href="./terms.html">Terms and Conditions</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Business Menu </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <!-- Add disabled class by default -->
                    <a class="dropdown-item" href="./business-search.html">Search for a Business</a>
                    <a class="dropdown-item disabled" href="./business-add.html">Add a Business</a>
                    <a class="dropdown-item disabled" href="./business-update.html">Update a Business</a>

                </div>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown2" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Incentives Menu </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <!-- Add disabled class by default -->
                    <a class="dropdown-item" href="./incentive-view.html">View an Incentive for a Business</a>
                    <a class="dropdown-item disabled" href="./incentive-add.html">Add an Incentive for a Business</a>
                    <a class="dropdown-item disabled" href="./incentive-update.html">Update an Incentive for a Business</a>

                </div>
            </li>
            <li class="nav-item dropdown admin-only" style="display: none;">
                <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Admin Menu
                </a>
                <div class="dropdown-menu" aria-labelledby="adminDropdown">
                    <a class="dropdown-item" href="./admin-dashboard.html">Admin Dashboard</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="./admin-users.html">User Management</a>
                    <a class="dropdown-item" href="./admin-business.html">Business Management</a>
                    <a class="dropdown-item" href="./admin-incentives.html">Incentive Management</a>
                    <a class="dropdown-item" href="./chain-management.html">Chain Management</a>
                </div>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        Sign In
                    </button>
                    <div class="dropdown-menu dropdown-menu-right">
                        <form class="px-4 py-3" id="login-form" onsubmit="handleLogin(); return false;">
                            <div class="form-group">
                                <label for="DropdownFormEmail1">Email address</label>
                                <input type="email" class="form-control" id="DropdownFormEmail1" placeholder="email@example.com">
                            </div>
                            <div class="form-group">
                                <label for="DropdownFormPassword1">Password</label>
                                <input type="password" class="form-control" id="DropdownFormPassword1" placeholder="Password">
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="dropdownCheck">
                                <label class="form-check-label" for="dropdownCheck">
                                    Remember me
                                </label>
                            </div>
                            <button type="submit" id="login-button" class="btn btn-primary">Sign in</button>
                        </form>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="./register.html">New around here? Sign up</a>
                        <a class="dropdown-item" href="./forgot-password.html">Forgot password?</a>
                    </div>
                </div>
            </li>
            <!-- User Dropdown - will be shown when logged in -->
            <li class="nav-item dropdown" id="user-dropdown" style="display: none;">
                <div class="btn-group">
                    <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false" id="userDisplayName">
                        User
                    </button>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="./profile.html">My Profile</a>
                        <a class="dropdown-item admin-only" style="display: none;" href="./admin-dashboard.html">Admin Dashboard</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" id="logout-button">Logout</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!-- Terms Update Modal -->
    <div class="modal fade" id="termsUpdateModal" tabindex="-1" role="dialog" aria-labelledby="termsUpdateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsUpdateModalLabel">Terms of Use Update</h5>
                    <button type="button" class="close" aria-label="Close" onclick="emergencyModalReset()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Our Terms of Use have been updated. Please review and accept the new terms to continue using our services.</p>

                    <div class="text-center mb-3">
                        <a href="terms.html" target="_blank" class="btn btn-info">Read Full Terms of Use</a>
                        <a href="privacy.html" target="_blank" class="btn btn-info ml-2">Read Privacy Policy</a>
                    </div>

                    <!-- Scrollable Summary Section -->
                    <div class="terms-summary" id="termsSummary">
                        <h4>Summary of Key Terms</h4>
                        <p><strong>Effective Date:</strong> May 14, 2025</p>

                        <h5>1. ACCEPTANCE OF TERMS</h5>
                        <p>By accessing or using Patriot Thanks, you agree to be bound by these Terms of Use. If you do not agree to these terms, you must discontinue use immediately.</p>

                        <h5>2. INTELLECTUAL PROPERTY RIGHTS</h5>
                        <p>All content, features, and functionality on Patriot Thanks are owned by Doc Bear Enterprises, LLC and are protected by copyright, trademark, and other intellectual property laws.</p>

                        <h5>3. USER RESPONSIBILITIES</h5>
                        <p>Users are responsible for maintaining the confidentiality of their account information and for all activities that occur under their account. Users must not engage in any prohibited activities as outlined in the full Terms of Use.</p>

                        <h5>4. DATA COLLECTION AND PRIVACY</h5>
                        <p>We collect certain personal information to provide our services. Your use of Patriot Thanks is also governed by our Privacy Policy, which describes how we collect, use, and protect your personal information.</p>

                        <h5>5. LIMITATION OF LIABILITY</h5>
                        <p>Patriot Thanks and its owners will not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use of the service.</p>

                        <h5>6. DISPUTE RESOLUTION</h5>
                        <p>Any disputes arising from your use of the service will be governed by the laws of Iowa. Disputes shall be resolved through binding arbitration in Cedar Rapids, Iowa.</p>

                        <h5>7. MODIFICATION OF TERMS</h5>
                        <p>We reserve the right to modify these terms at any time. Continued use of Patriot Thanks after such modifications constitutes acceptance of the updated terms.</p>

                        <h5>8. TERMINATION</h5>
                        <p>We reserve the right to terminate or suspend your account and access to Patriot Thanks at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users, us, or third parties.</p>

                        <h5>9. PROHIBITED ACTIVITIES</h5>
                        <p>Users are prohibited from using the service for any illegal purpose, attempting to gain unauthorized access, interfering with the proper working of the service, or engaging in any activity that could harm the service or other users.</p>

                        <h5>10. CONTACT INFORMATION</h5>
                        <p>For questions about these Terms, please contact us at privacy@patriotthanks.com.</p>

                        <!-- This element serves as a scroll target -->
                        <div id="termsScrollTarget">
                            <p>Thank you for reviewing our Terms of Use summary. Please check the box below to indicate your acceptance.</p>
                        </div>
                    </div>

                    <!-- Message that appears after scrolling -->
                    <div id="scrollMessage" style="display: none; color: green; margin-top: 10px; text-align: center;">
                        <i class="fa fa-check-circle"></i> You've reviewed the terms summary. Please check the box below to confirm your acceptance.
                    </div>

                    <!-- Checkbox area -->
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="acceptUpdatedTerms" disabled>
                        <label class="form-check-label" for="acceptUpdatedTerms">
                            I have read and agree to the updated <a href="terms.html" target="_blank">Terms of Use</a> and <a href="privacy.html" target="_blank">Privacy Policy</a>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="rejectUpdatedTerms" onclick="$('#rejectUpdatedTerms').trigger('click')">Decline</button>
                    <button type="button" class="btn btn-primary" id="confirmUpdatedTerms" disabled onclick="$('#confirmUpdatedTerms').trigger('click')">Accept Terms</button>
                </div>
            </div>
        </div>
    </div>
</nav>



<!-- Add custom styles for dropdown positioning -->
<style>
    /* Fix dropdown positioning for sign in menu */
    .dropdown-menu-right {
        right: 0;
        left: auto !important;
    }

    /* Add a min-width to prevent the dropdown from being too narrow */
    .navbar-nav .dropdown-menu {
        min-width: 300px;
    }

    /* Ensure the dropdown doesn't exceed viewport width on mobile */
    @media (max-width: 576px) {
        .navbar-nav .dropdown-menu {
            min-width: 100%;
            width: 100%;
        }
    }
</style>
<script>
    // Signal that the navbar (with modal) has been loaded
    $(document).ready(function() {
        // Dispatch a custom event that other scripts can listen for
        console.log("NavBar with modal HTML loaded - dispatching event");
        document.dispatchEvent(new CustomEvent('navbarWithModalLoaded'));

        // Force update on modal elements to ensure they're properly initialized
        setTimeout(function() {
            if (document.getElementById('termsUpdateModal')) {
                console.log("Modal elements present, making sure initialization occurs");

                // Check if login check needs to happen
                const sessionData = localStorage.getItem('patriotThanksSession');
                if (sessionData) {
                    console.log("Session found, checking terms acceptance status");
                    try {
                        const session = JSON.parse(sessionData);

                        // Check if we need to show the terms
                        const currentTermsVersion = "May 14, 2025";
                        if (!session.user.termsAccepted || session.user.termsVersion !== currentTermsVersion) {
                            console.log("Terms need acceptance - ensuring modal is ready");

                            // Make sure fixed-terms-modal initializes
                            if (typeof showFixedTermsModal === 'function') {
                                console.log("Using fixed terms implementation");
                            } else {
                                console.log("Using standard implementation");
                                // Initialize standard handlers
                                if (typeof setupTermsModalHandlers === 'function') {
                                    setupTermsModalHandlers();
                                }
                                if (typeof setupTermsScrollTracking === 'function') {
                                    setupTermsScrollTracking();
                                }
                            }
                        }
                    } catch (error) {
                        console.error("Error checking terms status:", error);
                    }
                }
            }
        }, 500);
    });
</script>