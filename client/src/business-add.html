<!DOCTYPE html>
<html lang='en'>
<head>
    <title>Patriot Thanks: Add a Business</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="author" content="Edward G. McKeown">
    <meta name="date" content="2025/4/12">
    <meta name="description" content="Patriot Thanks application to find businesses that offer
                                          incentives and discounts to veterans, active duty, first
                                          responders, and their spouses.">
    <meta name="keywords" content="business, incentives, discounts, veteran discounts, military discounts,
                                       first responder discounts, veterans, active duty, first responders">
    <link href="./images/docbearlogov4.png" rel="icon" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap-4.0.0.css" >
    <link href="./css/normalize.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <link href="./css/forms.css" rel="stylesheet">
    <link href="./css/menu-auth.css" rel="stylesheet">
    <link href="./css/form-validation.css" rel="stylesheet">
    <script src="./js/jquery-3.7.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="./js/bootstrap-4.0.0.js"></script>
    <script src="./js/business-validator.js"></script>
    <script src="./js/reset-functionality.js"></script>
</head>

<body style="padding-top: 70px" id="page_layout">
<!--Navigation bar-->
<div id="nav-placeholder">
</div>
<script>
    $(function(){
        $("#nav-placeholder").load("NavBar.html", function() {
            console.log("NavBar loaded");
            // Load the login handler after the navbar is loaded
            $.getScript("./js/login-handler.js")
            .done(function() {
                console.log("Login handler script loaded successfully");
            })
            .fail(function() {
                console.error("Failed to load login-handler.js");
            });
        });
    });
</script>
<!--end of Navigation bar-->
<header>
    <br>
    <div class="left-banner">
        <a href="index.html">
            <img src="./images/docbearlogov4.png" alt="DocBear logo">
        </a>
    </div>
    <div class="right-banner">
        <h1>Patriot Thanks</h1>
        <hr>
        <h4>Add a Business</h4>
    </div>
    <div style="clear:left;"></div>
</header>
<main>
    <section class="container">
        <h2>Add a business to our database</h2>
        <p class="paragraph_style">In Patriot Thanks, you can add a business within your local
            area that offers discounts and/or incentives for "active duty, veterans, first responders, and their
            spouses." If you know of a business that offers discounts and/or incentives, Please add them here. </p>
    </section>
    <div class="left_pane">
        <form id="business-form" onsubmit="return false;">
            <fieldset>
                <legend>
                    <h3 class="caveat">Business</h3>
                </legend>
                <fieldset>
                    <legend>
                        <h2 class="caveat">Basic Info</h2>
                    </legend>
                    <label for="bname">Business Name</label>
                    <input type="text" id="bname" name="business-name" placeholder="Business name...">
                    <br>
                    <label for="address1">Address Line 1&nbsp;</label>
                    <input type="text" id="address1" name="address1" placeholder="Address Line 1...">
                    <br>
                    <label for="address2">Address Line 2&nbsp;&nbsp;</label>
                    <input type="text" id="address2" name="address2" placeholder="Address Line 2...">
                    <br>
                    <label for="city">City&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <input type="text" id="city" name="city" placeholder="Business City is...">
                    <br>
                    <label for="state">U.S. State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <select name="state" id="state">
                        <option value="" selected="selected">Select a State</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="DC">District Of Columbia</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                    </select>
                    <br>
                    <label for="zip">Zip Code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <input type="text" id="zip" name="zip" placeholder="Business Zip Code...">
                    <br>
                    <label for="phone">Phone #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <input type="text" id="phone" name="phone-number" placeholder="Business phone number...">
                    <br>
                    <label for="type">Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <select name="type" id="type">
                        <option value="" selected="selected">Select a Business Type</option>
                        <option value="AUTO">Automotive</option>
                        <option value="BEAU">Beauty</option>
                        <option value="BOOK">Bookstore</option>
                        <option value="CLTH">Clothing</option>
                        <option value="CONV">Convenience Store/Gas Station</option>
                        <option value="DEPT">Department Store</option>
                        <option value="ELEC">Electronics</option>
                        <option value="ENTR">Entertainment</option>
                        <option value="FURN">Furniture</option>
                        <option value="FUEL">Fuel Station/Truck Stop</option>
                        <option value="GIFT">Gift Shop</option>
                        <option value="GROC">Grocery</option>
                        <option value="HARDW">Hardware</option>
                        <option value="HEAL">Health</option>
                        <option value="JEWL">Jewelry</option>
                        <option value="OTHER">Other</option>
                        <option value="RX">Pharmacy</option>
                        <option value="REST">Restaurant</option>
                        <option value="RETAIL">Retail</option>
                        <option value="SERV">Service</option>
                        <option value="SPEC">Specialty</option>
                        <option value="SPRT">Sporting Goods</option>
                        <option value="TECH">Technology</option>
                        <option value="TOYS">Toys</option>
                    </select>
                </fieldset>
                <br>

                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="submit" id="submit" value="Submit Business">
            </fieldset>

            <br><br><br>
        </form>
    </div>
    <div class="right_pane">
        <fieldset>
            <legend>
                <h3 class="caveat">Business Support</h3>
            </legend>
            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
            <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                <!-- Background -->
                <rect x="0" y="0" width="800" height="600" rx="20" ry="20" fill="#f8f8f8" stroke="#002868" stroke-width="8"/>

                <!-- Header Banner -->
                <rect x="20" y="20" width="760" height="100" rx="10" ry="10" fill="#002868"/>
                <text x="400" y="85" font-family="Arial, sans-serif" font-size="40" font-weight="bold" text-anchor="middle" fill="white">WE PROUDLY SUPPORT</text>

                <!-- American Flag Elements - left side -->
                <rect x="40" y="140" width="200" height="150" fill="#002868"/>

                <!-- Stars (simplified) -->
                <g fill="white">
                    <circle cx="63" cy="165" r="10"/>
                    <circle cx="103" cy="165" r="10"/>
                    <circle cx="143" cy="165" r="10"/>
                    <circle cx="183" cy="165" r="10"/>

                    <circle cx="83" cy="195" r="10"/>
                    <circle cx="123" cy="195" r="10"/>
                    <circle cx="163" cy="195" r="10"/>

                    <circle cx="63" cy="225" r="10"/>
                    <circle cx="103" cy="225" r="10"/>
                    <circle cx="143" cy="225" r="10"/>
                    <circle cx="183" cy="225" r="10"/>

                    <circle cx="83" cy="255" r="10"/>
                    <circle cx="123" cy="255" r="10"/>
                    <circle cx="163" cy="255" r="10"/>
                </g>

                <!-- Stripes -->
                <rect x="240" y="140" width="520" height="21.4" fill="#BF0A30"/>
                <rect x="240" y="161.4" width="520" height="21.4" fill="white"/>
                <rect x="240" y="182.8" width="520" height="21.4" fill="#BF0A30"/>
                <rect x="240" y="204.2" width="520" height="21.4" fill="white"/>
                <rect x="240" y="225.6" width="520" height="21.4" fill="#BF0A30"/>
                <rect x="240" y="247" width="520" height="21.4" fill="white"/>
                <rect x="240" y="268.4" width="520" height="21.6" fill="#BF0A30"/>

                <!-- Center Section -->
                <g>
                    <!-- Military Icon - Silhouette of a saluting soldier -->
                    <circle cx="200" cy="380" r="70" fill="#f0f0f0" stroke="#002868" stroke-width="3"/>
                    <path d="M180 350 v-30 h40 v10 l5 -15 h5 v35 h-10 v30 h-10 v20 h-20 v-30 h-10 z" fill="#002868"/>
                    <path d="M202 330 v-15 l8 5 v10 z" fill="#BF0A30"/>

                    <!-- Police/First Responder Icon -->
                    <circle cx="400" cy="380" r="70" fill="#f0f0f0" stroke="#002868" stroke-width="3"/>
                    <path d="M380 340 h40 l10 15 v15 h-60 v-15 z" fill="#002868"/>
                    <rect x="385" y="370" width="30" height="40" fill="#002868"/>
                    <circle cx="400" cy="330" r="15" fill="#002868"/>
                    <path d="M390 340 h20 v5 h-20 z" fill="#BF0A30"/>
                    <path d="M395 345 h10 v5 h-10 z" fill="#BF0A30"/>

                    <!-- EMT/Medical Icon -->
                    <circle cx="600" cy="380" r="70" fill="#f0f0f0" stroke="#002868" stroke-width="3"/>
                    <rect x="575" y="345" width="50" height="10" fill="#BF0A30"/>
                    <rect x="595" y="325" width="10" height="50" fill="#BF0A30"/>
                    <circle cx="600" cy="350" r="35" fill="none" stroke="#002868" stroke-width="5"/>
                </g>

                <!-- Bottom Section -->
                <rect x="20" y="480" width="760" height="100" rx="10" ry="10" fill="#002868"/>

                <!-- Using tspan to break the text into multiple lines -->
                <text x="400" y="525" font-family="Arial, sans-serif" font-size="34" font-weight="bold" text-anchor="middle" fill="white">
                    <tspan x="400" dy="0">MILITARY &amp; FIRST</tspan>
                    <tspan x="400" dy="40">RESPONDER DISCOUNT</tspan>
                </text>

                <!-- Line separators -->
                <line x1="40" y1="310" x2="760" y2="310" stroke="#002868" stroke-width="3"/>
                <line x1="40" y1="450" x2="760" y2="450" stroke="#002868" stroke-width="3"/>
            </svg>
        </fieldset>
        <br><br><br>

    </div>
</main>
<footer class = "footer_style"><br>
    <p>&copy; Copyright 2024 Doc Bear Enterprises, LLC</p>
</footer>
<script>
    // Script to prefill business-add form with data from a Google Maps POI
    document.addEventListener('DOMContentLoaded', function() {
        // Check if we have data to prefill the form
        const urlParams = new URLSearchParams(window.location.search);
        const shouldPrefill = urlParams.get('prefill') === 'true';

        if (shouldPrefill) {
            try {
                // Get the business data from sessionStorage
                const businessDataJson = sessionStorage.getItem('newBusinessData');
                if (!businessDataJson) {
                    console.warn("No business data found in sessionStorage");
                    return;
                }

                const businessData = JSON.parse(businessDataJson);
                console.log("Prefilling form with business data:", businessData);

                // Prefill the form fields
                const fields = {
                    'bname': businessData.name || '',
                    'address1': businessData.address1 || '',
                    'city': businessData.city || '',
                    'state': businessData.state || '',
                    'zip': businessData.zip || '',
                    'phone': businessData.phone || ''
                };

                // Set values for each field
                Object.keys(fields).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = fields[fieldId];

                        // Add visual indication that this field was prefilled
                        field.classList.add('prefilled');

                        // Add a small animation to highlight the prefilled fields
                        field.style.transition = 'background-color 1s ease';
                        field.style.backgroundColor = '#f0f8ff'; // Light blue background

                        // After 1.5 seconds, fade back to normal
                        setTimeout(() => {
                            field.style.backgroundColor = '';
                        }, 1500);
                    }
                });

                // Special handling for select elements (like state)
                const stateSelect = document.getElementById('state');
                if (stateSelect && businessData.state) {
                    for (let i = 0; i < stateSelect.options.length; i++) {
                        if (stateSelect.options[i].value === businessData.state) {
                            stateSelect.selectedIndex = i;
                            break;
                        }
                    }
                }

                // Store Place ID in a hidden field if it exists
                if (businessData.placeId) {
                    let placeIdField = document.getElementById('google_place_id');

                    // Create the field if it doesn't exist
                    if (!placeIdField) {
                        placeIdField = document.createElement('input');
                        placeIdField.type = 'hidden';
                        placeIdField.id = 'google_place_id';
                        placeIdField.name = 'google_place_id';

                        // Add it to the form
                        const form = document.querySelector('form');
                        if (form) {
                            form.appendChild(placeIdField);
                        }
                    }

                    // Set the Place ID
                    if (placeIdField) {
                        placeIdField.value = businessData.placeId;
                    }
                }

                // Store lat/lng in hidden fields if they exist
                if (businessData.lat && businessData.lng) {
                    console.log(`Storing coordinates: ${businessData.lat}, ${businessData.lng}`);

                    // Create hidden field for lat
                    let latField = document.getElementById('hidden_lat');
                    if (!latField) {
                        latField = document.createElement('input');
                        latField.type = 'hidden';
                        latField.id = 'hidden_lat';
                        latField.name = 'lat';
                        document.getElementById('business-form').appendChild(latField);
                    }
                    latField.value = businessData.lat;

                    // Create hidden field for lng
                    let lngField = document.getElementById('hidden_lng');
                    if (!lngField) {
                        lngField = document.createElement('input');
                        lngField.type = 'hidden';
                        lngField.id = 'hidden_lng';
                        lngField.name = 'lng';
                        document.getElementById('business-form').appendChild(lngField);
                    }
                    lngField.value = businessData.lng;
                }

                // Add a success message
                const formContainer = document.querySelector('fieldset');
                if (formContainer) {
                    const message = document.createElement('div');
                    message.className = 'success-message';
                    message.innerHTML = `
                    <p>Information from Google Maps has been pre-filled for your convenience.
                    Please review and complete any missing information before submitting.</p>
                `;
                    message.style.backgroundColor = '#dff0d8';
                    message.style.color = '#3c763d';
                    message.style.padding = '10px';
                    message.style.marginBottom = '15px';
                    message.style.borderRadius = '4px';

                    // Insert at the top of the form
                    formContainer.insertBefore(message, formContainer.firstChild);

                    // Remove the message after 8 seconds
                    setTimeout(() => {
                        message.style.transition = 'opacity 1s ease';
                        message.style.opacity = '0';

                        // Remove from DOM after fade out
                        setTimeout(() => {
                            if (message.parentNode) {
                                message.parentNode.removeChild(message);
                            }
                        }, 1000);
                    }, 8000);
                }

                // Clear the sessionStorage data to prevent reuse
                sessionStorage.removeItem('newBusinessData');

            } catch (error) {
                console.error("Error prefilling form:", error);
            }
        }
    });

</script>
</body>
</html>