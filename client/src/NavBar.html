<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="/index.html">
            <img src="./images/docbearlogov4.png" width="50" height="50" alt=""/>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent1"
                aria-controls="navbarSupportedContent1" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon">
            </span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent1">
            <ul id="menu" class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"> <a class="nav-link" href="./index.html">Home </a> </li>
                <li class="nav-item"> <a class="nav-link" href="./about.html">About</a> </li>
                <li class="nav-item"> <a class="nav-link" href="./contact.html" >Contact Us </a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownLegal" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Legal Menu </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownLegal">
                        <li><a class="dropdown-item" href="./privacy.html">Privacy Policy</a></li>
                        <li><a class="dropdown-item" href="./terms.html">Terms and Conditions</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Business Menu </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <!-- Add disabled class by default -->
                        <li><a class="dropdown-item" href="./business-search.html">Search for a Business</a></li>
                        <li><a class="dropdown-item disabled" href="./business-add.html">Add a Business</a></li>
                        <li><a class="dropdown-item disabled" href="./business-update.html">Update a Business</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown2" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Incentives Menu </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown2">
                        <!-- Add disabled class by default -->
                        <li><a class="dropdown-item" href="./incentive-view.html">View an Incentive for a Business</a></li>
                        <li><a class="dropdown-item disabled" href="./incentive-add.html">Add an Incentive for a Business</a></li>
                        <li><a class="dropdown-item disabled" href="./incentive-update.html">Update an Incentive for a Business</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown admin-only" style="display: none;">
                    <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Admin Menu
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                        <li><a class="dropdown-item" href="./admin-dashboard.html">Admin Dashboard</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="./admin-users.html">User Management</a></li>
                        <li><a class="dropdown-item" href="./admin-business.html">Business Management</a></li>
                        <li><a class="dropdown-item" href="./admin-incentives.html">Incentive Management</a></li>
                        <li><a class="dropdown-item" href="./chain-management.html">Chain Management</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <!-- Login Dropdown - shown when not logged in -->
                <li class="nav-item dropdown" id="login-dropdown-button">
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                                aria-expanded="false">
                            Sign In
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" id="login-dropdown-menu">
                            <li>
                                <form class="px-4 py-3" id="login-form">
                                    <div class="mb-3">
                                        <label for="DropdownFormEmail1" class="form-label">Email address</label>
                                        <input type="email" class="form-control" id="DropdownFormEmail1" placeholder="email@example.com">
                                    </div>
                                    <div class="mb-3">
                                        <label for="DropdownFormPassword1" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="DropdownFormPassword1" placeholder="Password">
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="dropdownCheck">
                                            <label class="form-check-label" for="dropdownCheck">
                                                Remember me
                                            </label>
                                        </div>
                                    </div>
                                    <button type="submit" id="login-button" class="btn btn-primary">Sign in</button>
                                </form>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="./register.html">New around here? Sign up</a></li>
                            <li><a class="dropdown-item" href="./forgot-password.html">Forgot password?</a></li>
                        </ul>
                    </div>
                </li>
                <!-- User Dropdown - will be shown when logged in -->
                <li class="nav-item dropdown" id="user-dropdown" style="display: none;">
                    <div class="btn-group">
                        <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown"
                                aria-expanded="false" id="userDisplayName">
                            User
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="./profile.html">My Profile</a></li>
                            <li><a class="dropdown-item admin-only" style="display: none;" href="./admin-dashboard.html">Admin Dashboard</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logout-button">Logout</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Terms Update Modal -->
    <div class="modal fade" id="termsUpdateModal" tabindex="-1" aria-labelledby="termsUpdateModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsUpdateModalLabel">Terms of Use Update</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Our Terms of Use have been updated. Please review and accept the new terms to continue using our services.</p>

                    <div class="text-center mb-3">
                        <a href="terms.html" target="_blank" class="btn btn-info">Read Full Terms of Use</a>
                        <a href="privacy.html" target="_blank" class="btn btn-info ms-2">Read Privacy Policy</a>
                    </div>

                    <!-- Scrollable Summary Section -->
                    <div class="terms-summary" id="termsSummary" style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin: 10px 0; background-color: #f9f9f9;">
                        <h4>Summary of Key Terms</h4>
                        <p><strong>Effective Date:</strong> May 14, 2025</p>

                        <h5>1. ACCEPTANCE OF TERMS</h5>
                        <p>By accessing or using Patriot Thanks, you agree to be bound by these Terms of Use. If you do not agree to these terms, you must discontinue use immediately.</p>

                        <h5>2. INTELLECTUAL PROPERTY RIGHTS</h5>
                        <p>All content, features, and functionality on Patriot Thanks are owned by Doc Bear Enterprises, LLC and are protected by copyright, trademark, and other intellectual property laws.</p>

                        <h5>3. USER RESPONSIBILITIES</h5>
                        <p>Users are responsible for maintaining the confidentiality of their account information and for all activities that occur under their account. Users must not engage in any prohibited activities as outlined in the full Terms of Use.</p>

                        <h5>4. DATA COLLECTION AND PRIVACY</h5>
                        <p>We collect certain personal information to provide our services. Your use of Patriot Thanks is also governed by our Privacy Policy, which describes how we collect, use, and protect your personal information.</p>

                        <h5>5. LIMITATION OF LIABILITY</h5>
                        <p>Patriot Thanks and its owners will not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use of the service.</p>

                        <h5>6. DISPUTE RESOLUTION</h5>
                        <p>Any disputes arising from your use of the service will be governed by the laws of Iowa. Disputes shall be resolved through binding arbitration in Cedar Rapids, Iowa.</p>

                        <h5>7. MODIFICATION OF TERMS</h5>
                        <p>We reserve the right to modify these terms at any time. Continued use of Patriot Thanks after such modifications constitutes acceptance of the updated terms.</p>

                        <h5>8. TERMINATION</h5>
                        <p>We reserve the right to terminate or suspend your account and access to Patriot Thanks at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users, us, or third parties.</p>

                        <h5>9. PROHIBITED ACTIVITIES</h5>
                        <p>Users are prohibited from using the service for any illegal purpose, attempting to gain unauthorized access, interfering with the proper working of the service, or engaging in any activity that could harm the service or other users.</p>

                        <h5>10. CONTACT INFORMATION</h5>
                        <p>For questions about these Terms, please contact us at privacy@patriotthanks.com.</p>

                        <!-- This element serves as a scroll target -->
                        <div id="termsScrollTarget">
                            <p>Thank you for reviewing our Terms of Use summary. Please check the box below to indicate your acceptance.</p>
                        </div>
                    </div>

                    <!-- Message that appears after scrolling -->
                    <div id="scrollMessage" style="display: none; color: green; margin-top: 10px; text-align: center;">
                        <i class="bi bi-check-circle"></i> You've reviewed the terms summary. Please check the box below to confirm your acceptance.
                    </div>

                    <!-- Checkbox area -->
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="acceptUpdatedTerms" disabled>
                        <label class="form-check-label" for="acceptUpdatedTerms">
                            I have read and agree to the updated <a href="terms.html" target="_blank">Terms of Use</a> and <a href="privacy.html" target="_blank">Privacy Policy</a>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="rejectUpdatedTerms">Decline</button>
                    <button type="button" class="btn btn-primary" id="confirmUpdatedTerms" disabled>Accept Terms</button>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Bootstrap 5 Modal Initialization Script -->
<script>
    $(document).ready(function() {
        console.log("Bootstrap 5 Modal Initialization Script loaded");

        // Check if Bootstrap 5 is available
        if (typeof bootstrap !== 'undefined') {
            console.log("Bootstrap 5 detected");

            // Initialize all dropdowns
            var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
            dropdownElementList.forEach(function(dropdownToggleEl) {
                new bootstrap.Dropdown(dropdownToggleEl);
            });
        } else {
            console.error("Bootstrap 5 not detected - some features may not work");
        }

        // Add a custom close handler directly on the modal's close button
        setTimeout(function() {
            const closeButton = document.querySelector('#termsUpdateModal .btn-close');
            if (closeButton) {
                closeButton.addEventListener('click', function(e) {
                    console.log("Close button clicked directly");

                    try {
                        const modalEl = document.getElementById('termsUpdateModal');
                        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                            const bsModal = bootstrap.Modal.getInstance(modalEl);
                            if (bsModal) {
                                bsModal.hide();
                            }
                        } else {
                            // Fallback direct DOM manipulation
                            const modalEl = document.getElementById('termsUpdateModal');
                            modalEl.classList.remove('show');
                            modalEl.style.display = 'none';
                            document.body.classList.remove('modal-open');
                            document.body.style.overflow = '';
                            const backdrop = document.querySelector('.modal-backdrop');
                            if (backdrop) backdrop.remove();
                        }
                    } catch (error) {
                        console.error("Error hiding modal:", error);

                        // Manual reset if function not available
                        $('.modal-backdrop').remove();
                        $('body').removeClass('modal-open');
                        $('body').css('padding-right', '');
                        $('#termsUpdateModal').modal('hide');
                        $('#termsUpdateModal').hide();
                    }
                });
            }
        }, 600);

        // Make emergency reset available on all pages
        window.emergencyModalReset = function() {
            console.log("Emergency modal reset called from NavBar");

            // Remove backdrop and reset modal
            $('.modal-backdrop').remove();
            $('body').removeClass('modal-open');
            $('body').css('padding-right', '');

            // Hide modal
            const modalEl = document.getElementById('termsUpdateModal');
            if (modalEl) {
                modalEl.classList.remove('show');
                modalEl.style.display = 'none';
            }

            return true;
        };
    });
</script>